# Тестовое задание
## ArmenApp с FastAPI

Это асинхронное REST API, реализованное с использованием FastAPI, асинхронного SQLAlchemy и PostgreSQL.

## Функционал

### Пользователь
- **Авторизация:** `POST /auth/login`
- **Получение счетов:** `GET /user/accounts`
- **Получение платежей:** `GET /user/payments`

### Администратор
- **Авторизация:** `POST /admin/auth/login`
- **Список пользователей:** `GET /admin/users`
- **Создание пользователя:** `POST /admin/users`
- **Обновление пользователя:** `PUT /admin/users/{user_id}`
- **Удаление пользователя:** `DELETE /admin/users/{user_id}`

### Платежи
- **Обработка вебхука:** `POST /webhook/payment`  
  Подпись формируется по правилу:  

- SHA256("{account_id}{amount}{transaction_id}{user_id}{secret_key}")


## Тестовые учётные данные

- **Пользователь:**
- Email: `user@example.com`
- Пароль: `user123`
- **Администратор:**
- Email: `admin@example.com`
- Пароль: `admin123`

## Запуск проекта

### С Docker Compose

1. Убедитесь, что установлены Docker и Docker Compose.
2. Из корневой директории выполните:
    ```bash
    docker-compose up --build
    ```
3. Приложение будет доступно по адресу: http://localhost:8000.
4. После первого старта выполните миграцию и создание тестовых данных. Для этого можно подключиться к контейнеру app:
    ```bash
    docker-compose exec app python migrate.py

## Без Docker Compose

Создайте и активируйте виртуальное окружение:
```bash
python -m venv venv
source venv/bin/activate   # Linux/Mac
venv\Scripts\activate      # Windows
```
Установите зависимости:
```bash
pip install -r requirements.txt
```
Настройте переменные окружения (например, создайте файл .env) или задайте их напрямую:

    DATABASE_URL – строка подключения к базе данных PostgreSQL (например, postgresql+asyncpg://myuser:mypassword@localhost:5432/mydb)
    SECRET_KEY – секретный ключ (например, gfdmhghif38yrf9ew0jkf32)

Выполните миграцию и создание тестовых данных:
```bash
python migrate.py
```
Запустите приложение:
```bash
python app/main.py
```
Приложение будет доступно по адресу: http://localhost:8000.


# Демонстрация работы программы
## 1. Демонстрация функционала для пользователя

### Шаг 1.1. Авторизация пользователя

Нажмите на кнопку "Пользователь" в меню.
В появившемся разделе заполните форму авторизации:

    Email: user@example.com
    Пароль: user123
Нажмите кнопку "Войти".
Если авторизация прошла успешно, форма скрывается, а в разделе появится сообщение вида:

    "Вы вошли как Test User (user@example.com)".

Шаг 1.2. Просмотр счетов

Нажмите кнопку "Получить счета".
На экране отобразится список счетов пользователя. Например, может быть показано:

    "Счет ID: 1, Баланс: 0".

Шаг 1.3. Просмотр платежей

Нажмите кнопку "Получить платежи".
Если ранее платежей не проводилось, список останется пустым. Позже, после проведения вебхука, здесь появятся записи с информацией о пополнениях.

## 2. Демонстрация функционала для администратора
Шаг 2.1. Авторизация администратора

Нажмите на кнопку "Администратор" в меню.
В разделе администратора заполните форму авторизации:

        Email: admin@example.com
        Пароль: admin123
Нажмите кнопку "Войти".
При успешной авторизации вы увидите сообщение вроде:
"Вы вошли как Test Admin (admin@example.com)".

Шаг 2.2. Просмотр списка пользователей

Нажмите кнопку "Получить список пользователей".
Система отобразит список всех пользователей с их данными, например:

        ID: 1, Name: Test User, Email: user@example.com, Role: user
        ID: 2, Name: Test Admin, Email: admin@example.com, Role: admin

## 3. Демонстрация работы Webhook

Шаг 3.1. Тестирование пополнения счета

Нажмите на кнопку "Webhook" в меню.
Заполните форму тестирования:

        Transaction ID: введите уникальное значение, например, test-tx-001.
        User ID: укажите идентификатор пользователя, например, 1 (если тестовый пользователь имеет ID 1).
        Account ID: введите идентификатор счета, например, 1 (если тестовый счет имеет ID 1).
        Amount: укажите сумму пополнения, например, 100.
Нажмите кнопку "Отправить".
При отправке фронтенд вычислит подпись (по SHA-256 с использованием секретного ключа) и отправит запрос на эндпоинт /webhook/payment.

Шаг 3.2. Проверка результата
После отправки запроса вы увидите сообщение с результатом работы вебхука, например:

    {"status": "Payment processed"}.
Теперь вернитесь в раздел пользователя и нажмите "Получить счета" – баланс соответствующего счета должен увеличиться на указанную сумму.
Также можно проверить раздел "Получить платежи", где появится новая запись с информацией о транзакции.

## 4. Дополнительные проверки

Документация API:

Перейдите по адресу http://localhost:8000/docs или http://localhost:8000/redoc для просмотра автоматически сгенерированной документации и тестирования API эндпоинтов напрямую.
